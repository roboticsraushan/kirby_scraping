<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nolon Campaign</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px;
            overflow: hidden;
        }
        
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 0;
        }
        
        .app-header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 300;
        }
        
        .upload-area {
            border: 3px dashed #e3f2fd;
            border-radius: 15px;
            padding: 8px;
            text-align: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            margin-bottom: 6px;
            max-width: 60%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #e8f4fd 0%, #f8f0ff 100%);
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: #4caf50;
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
        }
        
        .section-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .section-header {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .upload-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
        }
        
        .upload-section .section-header {
            background: linear-gradient(135deg, #2196f3 0%, #9c27b0 100%);
            color: white;
        }
        
        .template-section {
            background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
        }
        
        .template-section .section-header {
            background: linear-gradient(135deg, #ff9800 0%, #e91e63 100%);
            color: white;
        }
        
        .control-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #f3e5f5 100%);
        }
        
        .control-section .section-header {
            background: linear-gradient(135deg, #4caf50 0%, #9c27b0 100%);
            color: white;
        }
        
        .logs-section {
            background: linear-gradient(135deg, #fce4ec 0%, #e3f2fd 100%);
        }
        
        .logs-section .section-header {
            background: linear-gradient(135deg, #e91e63 0%, #2196f3 100%);
            color: white;
        }
        
        .progress-container {
            display: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .log-container {
            max-height: 180px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            border-left: 4px solid;
        }
        
        .log-success { 
            background: linear-gradient(135deg, #d4edda 0%, #c8e6c9 100%);
            color: #155724;
            border-left-color: #4caf50;
        }
        
        .log-error { 
            background: linear-gradient(135deg, #f8d7da 0%, #ffcdd2 100%);
            color: #721c24;
            border-left-color: #f44336;
        }
        
        .log-warning { 
            background: linear-gradient(135deg, #fff3cd 0%, #fff9c4 100%);
            color: #856404;
            border-left-color: #ff9800;
        }
        
        .log-info { 
            background: linear-gradient(135deg, #d1ecf1 0%, #b3e5fc 100%);
            color: #0c5460;
            border-left-color: #2196f3;
        }
        
        .template-preview {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .contact-preview {
            max-height: 120px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 10px;
        }
        
        .btn-campaign {
            min-width: 120px;
            border-radius: 25px;
            font-weight: 600;
            padding: 10px 25px;
            transition: all 0.3s ease;
        }
        
        .btn-campaign:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .status-running { background: #4caf50; }
        .status-stopped { background: #f44336; }
        .status-idle { background: #9e9e9e; }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            margin: 5px 0;
        }
        
        .stats-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .file-info-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- App Header -->
        <div class="app-header">
            <h1><i class="fas fa-envelope-open-text"></i> Nolon Campaign</h1>
            <p class="mb-0">Professional Email Outreach Platform</p>
        </div>

        <div class="container-fluid p-4">
            <div class="row">
                <!-- Left Half: Campaign Control & Logs -->
                <div class="col-md-6">
                    <!-- Campaign Control Section -->
                    <div class="section-card control-section">
                        <div class="section-header">
                            <i class="fas fa-rocket"></i> Campaign Control
                        </div>
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center mb-3">
                                <span class="status-indicator" id="statusIndicator"></span>
                                <span id="statusText" class="fw-bold">Ready to start campaign</span>
                            </div>
                            
                            <div class="d-flex gap-3 mb-3">
                                <button class="btn btn-success btn-campaign" id="startBtn" onclick="startCampaign()">
                                    <i class="fas fa-play"></i> Start Campaign
                                </button>
                                <button class="btn btn-danger btn-campaign" id="stopBtn" onclick="stopCampaign()" style="display: none;">
                                    <i class="fas fa-stop"></i> Stop Campaign
                                </button>
                            </div>
                            
                            <!-- Progress Stats -->
                            <div class="progress-container" id="progressContainer">
                                <div class="progress mb-3" style="height: 10px; border-radius: 5px;">
                                    <div class="progress-bar bg-success" id="progressBar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stats-card">
                                            <div class="stats-number text-success" id="sentCount">0</div>
                                            <div class="stats-label">Sent</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stats-card">
                                            <div class="stats-number text-danger" id="failedCount">0</div>
                                            <div class="stats-label">Failed</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stats-card">
                                            <div class="stats-number text-primary" id="totalCount">0</div>
                                            <div class="stats-label">Total</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Campaign Logs Section -->
                    <div class="section-card logs-section">
                        <div class="section-header">
                            <i class="fas fa-list"></i> Campaign Logs
                        </div>
                        <div class="card-body p-3">
                            <div class="log-container" id="logContainer">
                                <div class="text-muted text-center">No logs yet...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Half: Upload & Template -->
                <div class="col-md-6">
                    <!-- File Upload Section -->
                    <div class="section-card upload-section">
                        <div class="section-header">
                            <i class="fas fa-upload"></i> Upload Contacts
                        </div>
                        <div class="card-body p-3">
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-lg text-primary mb-1"></i>
                                <p class="mb-1 small">Drop your CSV file here</p>
                                <p class="text-muted small mb-2">or click to browse</p>
                                <input type="file" id="csvFile" accept=".csv" style="display: none;">
                                <button class="btn btn-primary btn-sm" onclick="document.getElementById('csvFile').click()">
                                    <i class="fas fa-folder-open"></i> Choose File
                                </button>
                            </div>
                            
                            <div id="fileInfo" class="file-info-card" style="display: none;">
                                <h6 class="mt-3">Contact Preview:</h6>
                                <div id="previewContent" class="contact-preview"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Email Template Section -->
                    <div class="section-card template-section">
                        <div class="section-header">
                            <i class="fas fa-edit"></i> Email Template
                        </div>
                        <div class="card-body p-3">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Subject Line:</label>
                                <input type="text" class="form-control" id="subjectLine" placeholder="Email subject..." value="Angel Investment Opportunity - Nolon AI Update">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Email Body:</label>
                                <textarea class="form-control" id="emailBody" rows="8" placeholder="Email content...">Hi {name},

A quick update from our side, and all of this has happened just in the last few weeks: 

‚Ä¢ Company is officially incorporated 
‚Ä¢ We've finalized a live+work villa setup in Bangalore, [work-eat-sleep-repeat]
‚Ä¢ Team's in motion: 4 interns onboarded, 2 full-time engineers joining soon
‚Ä¢ Procurement for key hardware is underway
‚Ä¢ MVP will be ready in 2 months[week-wise dev plan ready with contingency], and we kick off our first real-world pilot in Month 3 (in Bangalore), in a banglore it company washroom 

We're raising a ‚Çπ1.5‚Äì2 Cr angel round, got some commitment already, with ‚Çπ20L as minimum cheque size.

Would deeply appreciate if you could connect us with any angels who can bring patient capital to back a deeptech startup from India, for the world.

Will send over our updated vision slide + demo videos right after this ‚Äî feel free to forward them!

Thanks a lot for your continued support üôè

{sender_name}
{company_name}</textarea>
                            </div>




                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentFile = null;
        let statusInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupFileUpload();
        });

        // Setup file upload
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('csvFile');

            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });

            // File input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // Handle file upload
        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    currentFile = result.filename;
                    displayFileInfo(result);
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error uploading file: ' + error.message);
            }
        }

        // Display file information
        function displayFileInfo(data) {
            // Show preview
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '';
            
            data.preview.forEach(contact => {
                const contactDiv = document.createElement('div');
                contactDiv.className = 'border-bottom pb-2 mb-2';
                contactDiv.innerHTML = `
                    <strong>${contact.email || 'No email'}</strong><br>
                    <small class="text-muted">${contact.name || 'No name'}</small>
                `;
                previewContent.appendChild(contactDiv);
            });

            document.getElementById('fileInfo').style.display = 'block';
        }



        // Start campaign
        async function startCampaign() {
            if (!currentFile) {
                alert('Please upload a CSV file first');
                return;
            }

            const customSubject = document.getElementById('subjectLine').value;
            const customBody = document.getElementById('emailBody').value;

            if (!customSubject || !customBody) {
                alert('Please fill in both subject and body');
                return;
            }

            try {
                const response = await fetch('/start_campaign', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        filename: currentFile,
                        custom_subject: customSubject,
                        custom_body: customBody
                    })
                });

                const result = await response.json();

                if (result.success) {
                    updateStatus('running');
                    startStatusPolling();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error starting campaign: ' + error.message);
            }
        }

        // Stop campaign
        async function stopCampaign() {
            try {
                const response = await fetch('/stop_campaign', {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('stopped');
                    stopStatusPolling();
                }
            } catch (error) {
                console.error('Error stopping campaign:', error);
            }
        }

        // Update status
        function updateStatus(status) {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const progressContainer = document.getElementById('progressContainer');

            indicator.className = 'status-indicator';
            
            switch (status) {
                case 'running':
                    indicator.classList.add('status-running');
                    text.textContent = 'Campaign running...';
                    startBtn.style.display = 'none';
                    stopBtn.style.display = 'inline-block';
                    progressContainer.style.display = 'block';
                    break;
                case 'stopped':
                    indicator.classList.add('status-stopped');
                    text.textContent = 'Campaign stopped';
                    startBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'none';
                    break;
                default:
                    indicator.classList.add('status-idle');
                    text.textContent = 'Ready to start campaign';
                    startBtn.style.display = 'inline-block';
                    stopBtn.style.display = 'none';
                    progressContainer.style.display = 'none';
            }
        }

        // Start status polling
        function startStatusPolling() {
            statusInterval = setInterval(pollStatus, 1000);
        }

        // Stop status polling
        function stopStatusPolling() {
            if (statusInterval) {
                clearInterval(statusInterval);
                statusInterval = null;
            }
        }

        // Poll status
        async function pollStatus() {
            try {
                const response = await fetch('/status');
                const status = await response.json();
                
                // Update progress
                document.getElementById('progressBar').style.width = status.progress + '%';
                document.getElementById('sentCount').textContent = status.sent;
                document.getElementById('failedCount').textContent = status.failed;
                document.getElementById('totalCount').textContent = status.total;
                
                // Update status
                if (status.running) {
                    updateStatus('running');
                } else {
                    updateStatus('stopped');
                    stopStatusPolling();
                }
                
                // Update logs
                updateLogs();
                
            } catch (error) {
                console.error('Error polling status:', error);
            }
        }

        // Update logs
        async function updateLogs() {
            try {
                const response = await fetch('/logs');
                const data = await response.json();
                
                const logContainer = document.getElementById('logContainer');
                logContainer.innerHTML = '';
                
                data.logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = `log-entry log-${log.level}`;
                    logEntry.innerHTML = `<small>[${log.timestamp}]</small> ${log.message}`;
                    logContainer.appendChild(logEntry);
                });
                
                // Scroll to bottom
                logContainer.scrollTop = logContainer.scrollHeight;
                
            } catch (error) {
                console.error('Error updating logs:', error);
            }
        }
    </script>
</body>
</html> 